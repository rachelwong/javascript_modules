<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
	<meta charset="utf-8" />
	<title>Todo List</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css" />
</head>

<body class="has-text-centered">
	<progress class="progress is-primary" value="0" max="100">0</progress>
	<nav class="level">
		<div class="level-item">
			<div>
				<div class="heading">To Do</div>
				<h1 class="title is-1">0</h1>
			</div>
		</div>
	</nav>

	<form>
		<input type="text" class="input is-large is-primary has-text-centered" placeholder="add a todo!" value="" />
	</form>

	<br />

	<div id="tasks"></div>

	<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
	<script>
		// DEMONSTRATION in-class 
		//
		// Dollar $ign means jQuery
		//

		// Wait for the page to be ready before running our JS
		// sets up an eventlistener and wait for html to finish loading before running
		$(document).ready(() => {
			// Listen for form submission and a submit event handler
			$("form").submit(event => {
				// Prevent the browser from handling the form
				// stop the browser from doing anything to the form
				event.preventDefault()

				// Run the addTask function, pass it the current text in the input
				// looking for input field inside the form
				// val pulls text from the input field
				let task = $("form input").val()
				addTask(task)
				saveTask(task)
				// Set the input value back to empty after we add a task
				//clearing the input
				$("form input").val("")
			})

			// On task click
			$("#tasks").on("click", ".notification", function () {
				// Mark task as complete
				// Note we're not using arrow function syntax for our callback because we want to preserve 'this'.
				// In this context, 'this' refers to the notification that has been clicked.
				$(this).toggleClass("is-primary")

				// Update progress bar
				updateProgress()
			})

			addTask = task => {
				// Create a task and add it to #tasks
				// .prepend and .append is native jquery method
				$("#tasks").prepend($(`<div class="notification">${task}</div>`))
				// Update our h1 with the total number of tasks
				$("h1").text($("#tasks div").length)
			}

			saveTask = task => {
				// fetch existing task
				let existingTasks = localStorage.getItem("tasks") // Buy cheese, buy bread

				if (typeof existingTasks == "string") {
					// split into array
					existingTasks = existingTasks.split(",") //["buy cheese", "buy bread"]
					// add it back onto
					existingTasks.push(task)
					// add it back onto localStorage
					localStorage.setItem("tasks", existingTasks.join(", "))
				} else {
					// if there are no existingTasks, set a new task to local storage
					localStorage.setItem("tasks", task)
				}
			}

			// Load any stored todo items and restore them to the list
			loadTasks = () => {
				let task = localStorage.getItem(item)
				if (typeof tasks == "string") {
					tasks.forEach(task => {
						addTask()
					})
				}
			}

			// Update progress bar
			updateProgress = () => {
				const totalTasks = $("#tasks div").length
				const completedTasks = $("#tasks div.notification.is-primary").length
				$("progress").val((completedTasks / totalTasks) * 100)
			}
			loadTasks()
		})
	</script>
</body>

</html>